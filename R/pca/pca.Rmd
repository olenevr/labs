---
title: "pca"
author: "Roman Olenev"
date: "2023-10-25"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("FactoMineR")
library("factoextra")
library(ggplot2)
library(GGally)
```

```{r}
dataset <- read.csv("IFDGIPLI.DAT", sep="")
head(dataset)
```
```{r}
data <- dataset[,-1]
head(data)
```

```{r}
ggpairs(data)
```


```{r}
res.pca <- PCA(data, ncp=4)
```

Первый график - проекции индивидов на пространство из первых 2 главных компонент ($z_{i1},z_{i2}$)

Второй график - исходные признаки с координатами ($f_{i1},f_{i2}$) равными корреляции между ними и главными компонентами


Векторы U 

Интерпретируем новые признаки на основе формулы $Z_i=XU_i$ (линейная комбинация исходных признаков)

Первая главная компонента - общий уровень (чем больше значение, тем менее здоровый человек)

Вторая главная компонента - разнца между индексами 

Третья главная комопнента - разница между FDGI+IPLI и IDGI+FPLI

Четвертая главная компонента - разница по времени (F - I)
```{r}
res.pca$svd$V
```

Собственные числа и вклад в общую дисперсию
```{r}
res.pca$eig
```

```{r}
fviz_eig(res.pca, addlabels = TRUE, ylim = c(0, 50))
```

Координаты признаков (матрица F)
```{r}
res.pca$var$coord
```

$f_{ij}^2$
```{r}
res.pca$var$cos2
```

$\frac{f_{ij}^2}{\lambda_j}\cdot{100}$, фактически векторы U с элементами, возведенными в квадрат и умноженными на 100
```{r}
res.pca$var$contrib
```
Координаты индивидов в новых признаках (матрица Z)
```{r}
res.pca$ind$coord[1:6,]
```

$\frac{z_{ij}^2}{||x_i||^2}$, $x_i$ - индивид
```{r}
res.pca$ind$cos2[1:6,]
```

Индивиды и проекции ортов ($\tilde{z}_{ij}=\langle e_i,U_j \rangle,\ i=\overline{1,4},\ j=\overline{1,2}$) в плоскости первых 2 главных компонент
```{r}
fviz_pca_biplot(res.pca, repel = FALSE,
                col.var = "#2E9FDF",
                col.ind = "#696969" 
                )
```

Выброс, индивид 31: Общий уровень существенно ниже среднего (т.к. минимальное значение по первой главной компоненте), то есть индивид более здоров, чем группа в среднем. Разность между PLI и DGI ниже среднего. (У индивида самые здоровые в целом зубы, по индексам ситуация с DGI хуже, чем с PLI)

```{r}
data[31,]
```

Выброс, индивид 83: У индивида самые больные в целом зубы, ситуация плохая по обоим индексам, так как вторая главная компонента близка к 0
```{r}
data[83,]
```

Удалим выбросы
```{r}
res.pca2 <- PCA(data[-c(31,83),], ncp=4)
```

Biplot без выбросов
```{r}
fviz_pca_biplot(res.pca2, repel = FALSE,
                col.var = "#2E9FDF", 
                col.ind = "#696969"
                )
```

